import{E as Te,V as S,M as it,T as at,Q as Pt,S as $t,a as _,R as De,P as Pe,b as X,G as rt,c as D,d as N,e as C,B as $,f as Y,g as Mt,h as Le,i as wt,j as ke,C as Lt,k as Qt,l as kt,m as Fe,n as ne,A as Ft,o as ie,p as Oe,q as Re,L as Ne,r as ze,s as Be,t as It,u as Ve,v as Ue,w as Ge,x as _e,W as je,y as Ye,F as He,z as We,D as ae}from"./three-cb54460a.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function o(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(s){if(s.ep)return;s.ep=!0;const n=o(s);fetch(s.href,n)}})();const Jt={type:"change"},At={type:"start"},te={type:"end"},yt=new De,ee=new Pe,Xe=Math.cos(70*X.DEG2RAD);class Ke extends Te{constructor(e,o){super(),this.object=e,this.domElement=o,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new S,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:it.ROTATE,MIDDLE:it.DOLLY,RIGHT:it.PAN},this.touches={ONE:at.ROTATE,TWO:at.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(i){i.addEventListener("keydown",Et),this._domElementKeyEvents=i},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Et),this._domElementKeyEvents=null},this.saveState=function(){t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=function(){t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(Jt),t.update(),n=s.NONE},this.update=function(){const i=new S,p=new Pt().setFromUnitVectors(e.up,new S(0,1,0)),T=p.clone().invert(),P=new S,R=new Pt,nt=new S,tt=2*Math.PI;return function(){const qt=t.object.position;i.copy(qt).sub(t.target),i.applyQuaternion(p),l.setFromVector3(i),t.autoRotate&&n===s.NONE&&B(ct()),t.enableDamping?(l.theta+=a.theta*t.dampingFactor,l.phi+=a.phi*t.dampingFactor):(l.theta+=a.theta,l.phi+=a.phi);let Z=t.minAzimuthAngle,q=t.maxAzimuthAngle;isFinite(Z)&&isFinite(q)&&(Z<-Math.PI?Z+=tt:Z>Math.PI&&(Z-=tt),q<-Math.PI?q+=tt:q>Math.PI&&(q-=tt),Z<=q?l.theta=Math.max(Z,Math.min(q,l.theta)):l.theta=l.theta>(Z+q)/2?Math.max(Z,l.theta):Math.min(q,l.theta)),l.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,l.phi)),l.makeSafe(),t.enableDamping===!0?t.target.addScaledVector(h,t.dampingFactor):t.target.add(h),t.zoomToCursor&&G||t.object.isOrthographicCamera?l.radius=Ct(l.radius):l.radius=Ct(l.radius*c),i.setFromSpherical(l),i.applyQuaternion(T),qt.copy(t.target).add(i),t.object.lookAt(t.target),t.enableDamping===!0?(a.theta*=1-t.dampingFactor,a.phi*=1-t.dampingFactor,h.multiplyScalar(1-t.dampingFactor)):(a.set(0,0,0),h.set(0,0,0));let mt=!1;if(t.zoomToCursor&&G){let ht=null;if(t.object.isPerspectiveCamera){const ut=i.length();ht=Ct(ut*c);const ft=ut-ht;t.object.position.addScaledVector(A,ft),t.object.updateMatrixWorld()}else if(t.object.isOrthographicCamera){const ut=new S(L.x,L.y,0);ut.unproject(t.object),t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/c)),t.object.updateProjectionMatrix(),mt=!0;const ft=new S(L.x,L.y,0);ft.unproject(t.object),t.object.position.sub(ft).add(ut),t.object.updateMatrixWorld(),ht=i.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),t.zoomToCursor=!1;ht!==null&&(this.screenSpacePanning?t.target.set(0,0,-1).transformDirection(t.object.matrix).multiplyScalar(ht).add(t.object.position):(yt.origin.copy(t.object.position),yt.direction.set(0,0,-1).transformDirection(t.object.matrix),Math.abs(t.object.up.dot(yt.direction))<Xe?e.lookAt(t.target):(ee.setFromNormalAndCoplanarPoint(t.object.up,t.target),yt.intersectPlane(ee,t.target))))}else t.object.isOrthographicCamera&&(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/c)),t.object.updateProjectionMatrix(),mt=!0);return c=1,G=!1,mt||P.distanceToSquared(t.object.position)>r||8*(1-R.dot(t.object.quaternion))>r||nt.distanceToSquared(t.target)>0?(t.dispatchEvent(Jt),P.copy(t.object.position),R.copy(t.object.quaternion),nt.copy(t.target),mt=!1,!0):!1}}(),this.dispose=function(){t.domElement.removeEventListener("contextmenu",Kt),t.domElement.removeEventListener("pointerdown",Wt),t.domElement.removeEventListener("pointercancel",dt),t.domElement.removeEventListener("wheel",Xt),t.domElement.removeEventListener("pointermove",St),t.domElement.removeEventListener("pointerup",dt),t._domElementKeyEvents!==null&&(t._domElementKeyEvents.removeEventListener("keydown",Et),t._domElementKeyEvents=null)};const t=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let n=s.NONE;const r=1e-6,l=new $t,a=new $t;let c=1;const h=new S,u=new _,m=new _,w=new _,f=new _,y=new _,x=new _,g=new _,M=new _,I=new _,A=new S,L=new _;let G=!1;const b=[],ot={};function ct(){return 2*Math.PI/60/60*t.autoRotateSpeed}function O(){return Math.pow(.95,t.zoomSpeed)}function B(i){a.theta-=i}function J(i){a.phi-=i}const Ot=function(){const i=new S;return function(T,P){i.setFromMatrixColumn(P,0),i.multiplyScalar(-T),h.add(i)}}(),Rt=function(){const i=new S;return function(T,P){t.screenSpacePanning===!0?i.setFromMatrixColumn(P,1):(i.setFromMatrixColumn(P,0),i.crossVectors(t.object.up,i)),i.multiplyScalar(T),h.add(i)}}(),st=function(){const i=new S;return function(T,P){const R=t.domElement;if(t.object.isPerspectiveCamera){const nt=t.object.position;i.copy(nt).sub(t.target);let tt=i.length();tt*=Math.tan(t.object.fov/2*Math.PI/180),Ot(2*T*tt/R.clientHeight,t.object.matrix),Rt(2*P*tt/R.clientHeight,t.object.matrix)}else t.object.isOrthographicCamera?(Ot(T*(t.object.right-t.object.left)/t.object.zoom/R.clientWidth,t.object.matrix),Rt(P*(t.object.top-t.object.bottom)/t.object.zoom/R.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}}();function bt(i){t.object.isPerspectiveCamera||t.object.isOrthographicCamera?c/=i:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function Nt(i){t.object.isPerspectiveCamera||t.object.isOrthographicCamera?c*=i:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function zt(i){if(!t.zoomToCursor)return;G=!0;const p=t.domElement.getBoundingClientRect(),T=i.clientX-p.left,P=i.clientY-p.top,R=p.width,nt=p.height;L.x=T/R*2-1,L.y=-(P/nt)*2+1,A.set(L.x,L.y,1).unproject(e).sub(e.position).normalize()}function Ct(i){return Math.max(t.minDistance,Math.min(t.maxDistance,i))}function Bt(i){u.set(i.clientX,i.clientY)}function ue(i){zt(i),g.set(i.clientX,i.clientY)}function Vt(i){f.set(i.clientX,i.clientY)}function pe(i){m.set(i.clientX,i.clientY),w.subVectors(m,u).multiplyScalar(t.rotateSpeed);const p=t.domElement;B(2*Math.PI*w.x/p.clientHeight),J(2*Math.PI*w.y/p.clientHeight),u.copy(m),t.update()}function me(i){M.set(i.clientX,i.clientY),I.subVectors(M,g),I.y>0?bt(O()):I.y<0&&Nt(O()),g.copy(M),t.update()}function fe(i){y.set(i.clientX,i.clientY),x.subVectors(y,f).multiplyScalar(t.panSpeed),st(x.x,x.y),f.copy(y),t.update()}function ye(i){zt(i),i.deltaY<0?Nt(O()):i.deltaY>0&&bt(O()),t.update()}function ge(i){let p=!1;switch(i.code){case t.keys.UP:i.ctrlKey||i.metaKey||i.shiftKey?J(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):st(0,t.keyPanSpeed),p=!0;break;case t.keys.BOTTOM:i.ctrlKey||i.metaKey||i.shiftKey?J(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):st(0,-t.keyPanSpeed),p=!0;break;case t.keys.LEFT:i.ctrlKey||i.metaKey||i.shiftKey?B(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):st(t.keyPanSpeed,0),p=!0;break;case t.keys.RIGHT:i.ctrlKey||i.metaKey||i.shiftKey?B(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):st(-t.keyPanSpeed,0),p=!0;break}p&&(i.preventDefault(),t.update())}function Ut(){if(b.length===1)u.set(b[0].pageX,b[0].pageY);else{const i=.5*(b[0].pageX+b[1].pageX),p=.5*(b[0].pageY+b[1].pageY);u.set(i,p)}}function Gt(){if(b.length===1)f.set(b[0].pageX,b[0].pageY);else{const i=.5*(b[0].pageX+b[1].pageX),p=.5*(b[0].pageY+b[1].pageY);f.set(i,p)}}function _t(){const i=b[0].pageX-b[1].pageX,p=b[0].pageY-b[1].pageY,T=Math.sqrt(i*i+p*p);g.set(0,T)}function we(){t.enableZoom&&_t(),t.enablePan&&Gt()}function xe(){t.enableZoom&&_t(),t.enableRotate&&Ut()}function jt(i){if(b.length==1)m.set(i.pageX,i.pageY);else{const T=vt(i),P=.5*(i.pageX+T.x),R=.5*(i.pageY+T.y);m.set(P,R)}w.subVectors(m,u).multiplyScalar(t.rotateSpeed);const p=t.domElement;B(2*Math.PI*w.x/p.clientHeight),J(2*Math.PI*w.y/p.clientHeight),u.copy(m)}function Yt(i){if(b.length===1)y.set(i.pageX,i.pageY);else{const p=vt(i),T=.5*(i.pageX+p.x),P=.5*(i.pageY+p.y);y.set(T,P)}x.subVectors(y,f).multiplyScalar(t.panSpeed),st(x.x,x.y),f.copy(y)}function Ht(i){const p=vt(i),T=i.pageX-p.x,P=i.pageY-p.y,R=Math.sqrt(T*T+P*P);M.set(0,R),I.set(0,Math.pow(M.y/g.y,t.zoomSpeed)),bt(I.y),g.copy(M)}function be(i){t.enableZoom&&Ht(i),t.enablePan&&Yt(i)}function Ce(i){t.enableZoom&&Ht(i),t.enableRotate&&jt(i)}function Wt(i){t.enabled!==!1&&(b.length===0&&(t.domElement.setPointerCapture(i.pointerId),t.domElement.addEventListener("pointermove",St),t.domElement.addEventListener("pointerup",dt)),Ie(i),i.pointerType==="touch"?ve(i):Se(i))}function St(i){t.enabled!==!1&&(i.pointerType==="touch"?Me(i):Ee(i))}function dt(i){Ae(i),b.length===0&&(t.domElement.releasePointerCapture(i.pointerId),t.domElement.removeEventListener("pointermove",St),t.domElement.removeEventListener("pointerup",dt)),t.dispatchEvent(te),n=s.NONE}function Se(i){let p;switch(i.button){case 0:p=t.mouseButtons.LEFT;break;case 1:p=t.mouseButtons.MIDDLE;break;case 2:p=t.mouseButtons.RIGHT;break;default:p=-1}switch(p){case it.DOLLY:if(t.enableZoom===!1)return;ue(i),n=s.DOLLY;break;case it.ROTATE:if(i.ctrlKey||i.metaKey||i.shiftKey){if(t.enablePan===!1)return;Vt(i),n=s.PAN}else{if(t.enableRotate===!1)return;Bt(i),n=s.ROTATE}break;case it.PAN:if(i.ctrlKey||i.metaKey||i.shiftKey){if(t.enableRotate===!1)return;Bt(i),n=s.ROTATE}else{if(t.enablePan===!1)return;Vt(i),n=s.PAN}break;default:n=s.NONE}n!==s.NONE&&t.dispatchEvent(At)}function Ee(i){switch(n){case s.ROTATE:if(t.enableRotate===!1)return;pe(i);break;case s.DOLLY:if(t.enableZoom===!1)return;me(i);break;case s.PAN:if(t.enablePan===!1)return;fe(i);break}}function Xt(i){t.enabled===!1||t.enableZoom===!1||n!==s.NONE||(i.preventDefault(),t.dispatchEvent(At),ye(i),t.dispatchEvent(te))}function Et(i){t.enabled===!1||t.enablePan===!1||ge(i)}function ve(i){switch(Zt(i),b.length){case 1:switch(t.touches.ONE){case at.ROTATE:if(t.enableRotate===!1)return;Ut(),n=s.TOUCH_ROTATE;break;case at.PAN:if(t.enablePan===!1)return;Gt(),n=s.TOUCH_PAN;break;default:n=s.NONE}break;case 2:switch(t.touches.TWO){case at.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;we(),n=s.TOUCH_DOLLY_PAN;break;case at.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;xe(),n=s.TOUCH_DOLLY_ROTATE;break;default:n=s.NONE}break;default:n=s.NONE}n!==s.NONE&&t.dispatchEvent(At)}function Me(i){switch(Zt(i),n){case s.TOUCH_ROTATE:if(t.enableRotate===!1)return;jt(i),t.update();break;case s.TOUCH_PAN:if(t.enablePan===!1)return;Yt(i),t.update();break;case s.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;be(i),t.update();break;case s.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;Ce(i),t.update();break;default:n=s.NONE}}function Kt(i){t.enabled!==!1&&i.preventDefault()}function Ie(i){b.push(i)}function Ae(i){delete ot[i.pointerId];for(let p=0;p<b.length;p++)if(b[p].pointerId==i.pointerId){b.splice(p,1);return}}function Zt(i){let p=ot[i.pointerId];p===void 0&&(p=new _,ot[i.pointerId]=p),p.set(i.pageX,i.pageY)}function vt(i){const p=i.pointerId===b[0].pointerId?b[1]:b[0];return ot[p.pointerId]}t.domElement.addEventListener("contextmenu",Kt),t.domElement.addEventListener("pointerdown",Wt),t.domElement.addEventListener("pointercancel",dt),t.domElement.addEventListener("wheel",Xt,{passive:!1}),this.update()}}function Ze(d=100){const e=new rt,o=25,t=5,s=d,n=8,r=2.5,l=1.5,a=.6,c=n+r,h=Math.floor(s/c),u=new D({color:3355443,flatShading:!0}),m=new D({color:2236962,flatShading:!0});new D({color:3355443,flatShading:!0});const w=new D({color:5592405,flatShading:!0}),f=2e4,y=new N(f,f),x=new D({color:3825419,flatShading:!0}),g=new C(y,x);g.rotation.x=-Math.PI/2,g.position.y=-.1,g.receiveShadow=!0,e.add(g),$e(e,s,h,n,r,l,m);const M=[];for(let I=0;I<5;I++){const A=.6+I*.15,L=.6+I*.15,G=new $(n*A/3,o,n*L/3);M.push(G)}for(let I=0;I<h;I++)for(let A=0;A<h;A++){const L=(I-h/2)*c+c/2,G=(A-h/2)*c+c/2;qe(e,L,G,n,M,u,a,t,o),Je(e,L,G,n,w)}return e}function qe(d,e,o,t,s,n,r,l,a){const c=Math.sqrt(e*e+o*o),h=Math.sqrt(2)*(t*Math.floor(100/(t+2.5))/2),u=c/h,m=u<.3,w=u>=.3&&u<.6;let f,y,x;if(m)f=Math.floor(Math.random()*3)+4,y=l*2,x=a;else if(w)f=Math.floor(Math.random()*3)+2,y=l*1.5,x=a*.8;else if(f=Math.floor(Math.random()*2)+1,y=l,x=a*.5,Math.random()<.3)return;const g=t*.85;for(let M=0;M<f;M++){if(Math.random()>(m?r+.1:w?r:r-.1))continue;const I=(Math.random()-.5)*g,A=(Math.random()-.5)*g,L=e+I,G=o+A,b=Math.floor(Math.random()*s.length),ot=s[b].clone(),ct=Math.random()*(x-y)+y,O=new C(ot,n.clone());let B=.2;m?B=.15:w?B=.25:B=.3;const J=Math.random()*.2-.1;O.material.color.setRGB(B+J,B+J,B+J),O.position.set(L,ct/2,G),O.scale.y=ct/a,O.rotation.y=Math.random()*Math.PI*2,O.castShadow=!0,O.receiveShadow=!0,d.add(O),to(O,ct)}}function $e(d,e,o,t,s,n,r,l){const a=t+s,c=o*a,h=new C(new N(c,c),r);h.rotation.x=-Math.PI/2,h.position.y=.01,h.receiveShadow=!0,d.add(h);for(let u=0;u<=o;u++){const m=(u-o/2)*a,w=s,f=new C(new N(c,w),r);f.rotation.x=-Math.PI/2,f.position.set(0,.02,m),f.receiveShadow=!0,d.add(f);const y=new C(new N(c,.1),new Y({color:16777215}));y.rotation.x=-Math.PI/2,y.position.set(0,.03,m),d.add(y);const x=Math.floor(c/2);for(let g=0;g<x;g++)if(g%2===0){const M=(g-x/2)*2+1;for(const I of[s*.25,-s*.25]){const A=new C(new N(1,.1),new Y({color:16777215}));A.rotation.x=-Math.PI/2,A.position.set(M,.03,m+I),d.add(A)}}}for(let u=0;u<=o;u++){const m=(u-o/2)*a,w=s,f=new C(new N(w,c),r);f.rotation.x=-Math.PI/2,f.position.set(m,.02,0),f.receiveShadow=!0,d.add(f);const y=new C(new N(.1,c),new Y({color:16777215}));y.rotation.x=-Math.PI/2,y.position.set(m,.03,0),d.add(y);const x=Math.floor(c/2);for(let g=0;g<x;g++)if(g%2===0){const M=(g-x/2)*2+1;for(const I of[s*.25,-s*.25]){const A=new C(new N(.1,1),new Y({color:16777215}));A.rotation.x=-Math.PI/2,A.position.set(m+I,.03,M),d.add(A)}}}for(let u=0;u<=o;u++)for(let m=0;m<=o;m++){const w=(u-o/2)*a,f=(m-o/2)*a;Qe(d,w,f,s)}}function Qe(d,e,o,t){const r=t*.7,l=r/6;for(let a=0;a<6;a++){const c=o+t*.35-a*l,h=new C(new N(.3,r),new Y({color:16777215}));h.rotation.x=-Math.PI/2,h.position.set(e,.03,c),d.add(h)}for(let a=0;a<6;a++){const c=o-t*.35+a*l,h=new C(new N(.3,r),new Y({color:16777215}));h.rotation.x=-Math.PI/2,h.position.set(e,.03,c),d.add(h)}for(let a=0;a<6;a++){const c=e+t*.35-a*l,h=new C(new N(r,.3),new Y({color:16777215}));h.rotation.x=-Math.PI/2,h.position.set(c,.03,o),d.add(h)}for(let a=0;a<6;a++){const c=e-t*.35+a*l,h=new C(new N(r,.3),new Y({color:16777215}));h.rotation.x=-Math.PI/2,h.position.set(c,.03,o),d.add(h)}}function Je(d,e,o,t,s){const l=t-.8,a=new C(new $(t,.1,t),s);a.position.set(e,.1/2,o),a.receiveShadow=!0,d.add(a);const c=new C(new $(l,.1+.01,l),new D({color:4473924}));c.position.set(e,.1/2,o),c.receiveShadow=!0,d.add(c)}function to(d,e){const o=d.geometry.parameters.width,t=e,s=d.geometry.parameters.depth,n=Math.ceil(t/2),r=Math.ceil(o*3),l=Math.ceil(s*3),a=.15,c=new D({color:16777164,emissive:16777164,emissiveIntensity:Math.random()*.3+.1});for(let h=0;h<n;h++){const u=Math.random()*.7+.3;for(let m=0;m<r;m++){if(Math.random()>.7)continue;const f=Math.random()<u?c:new D({color:1118481}),y=-o/2+o/r*(m+.5),x=-t/2+t/n*(h+.5),g=s/2+.01;gt(d,y,x,g,a,f,0),gt(d,y,x,-g,a,f,1)}}for(let h=0;h<n;h++){const u=Math.random()*.7+.3;for(let m=0;m<l;m++){if(Math.random()>.7)continue;const f=Math.random()<u?c:new D({color:1118481}),y=-s/2+s/l*(m+.5),x=-t/2+t/n*(h+.5),g=o/2+.01;gt(d,g,x,y,a,f,2),gt(d,-g,x,y,a,f,3)}}}function gt(d,e,o,t,s,n,r){if(Math.random()>.8)return;const l=new N(s,s),a=new C(l,n);a.position.set(e,o,t),r===0?a.rotation.y=0:r===1?a.rotation.y=Math.PI:r===2?a.rotation.y=-Math.PI/2:r===3&&(a.rotation.y=Math.PI/2),d.add(a)}function eo(){const d=new $(1e3,1e3,1e3),e=[];e.push(new Y({color:8900331,side:Mt})),e.push(new Y({color:2763306,side:Mt}));for(let t=0;t<4;t++){const s=new Y({color:8900331,side:Mt});e.push(s)}return new C(d,e)}const v={PITCH_SENSITIVITY:1,ROLL_SENSITIVITY:3,TURN_SENSITIVITY:2.5,YAW_COUPLING:.8,MAX_PITCH:X.degToRad(75),MAX_ROLL:X.degToRad(75),MIN_SPEED:10,MAX_SPEED:50,DEFAULT_SPEED:30,SPEED_INCREMENT:5,AUTO_LEVEL_RATE:.002,AUTO_LEVEL_DELAY:5,INPUT_SMOOTHING:.2,CAMERA_SMOOTHING:.05,TURN_RATE_FACTOR:1.2,GRAVITY_FACTOR:.5,CLIMB_FACTOR:.8,DRAG_FACTOR:.05};class oo{constructor(e,o){this.plane=e,this.camera=o,this.speed=v.DEFAULT_SPEED,this.rotation=new Le(0,0,0,"YXZ"),this.quaternion=new Pt,this.velocity=new S(0,0,this.speed),this.heading=0,this.altitude=e.position.y,this.verticalSpeed=0,this.timeSinceInput=0,this.inputs={pitch:0,roll:0,throttle:0,cameraToggle:!1,shoot:!1},this.prevInputs={pitch:0,roll:0},this.controlValues={pitch:0,roll:0,yaw:0},this.cameraMode="follow",this.cameraOffset=new S(0,3,15),this.cameraTarget=new S,this.cameraLookAt=new S,this.initEventListeners()}initEventListeners(){window.addEventListener("keydown",e=>this.handleKeyDown(e)),window.addEventListener("keyup",e=>this.handleKeyUp(e))}handleKeyDown(e){switch(e.key.toLowerCase()){case"w":this.inputs.pitch=1,this.timeSinceInput=0;break;case"s":this.inputs.pitch=-1,this.timeSinceInput=0;break;case"a":this.inputs.roll=1,this.timeSinceInput=0;break;case"d":this.inputs.roll=-1,this.timeSinceInput=0;break;case"q":this.speed>v.MIN_SPEED&&(this.speed-=v.SPEED_INCREMENT);break;case"e":this.speed<v.MAX_SPEED&&(this.speed+=v.SPEED_INCREMENT);break;case"c":this.inputs.cameraToggle||(this.cameraMode=this.cameraMode==="follow"?"orbit":"follow",this.inputs.cameraToggle=!0);break;case" ":this.inputs.shoot=!0;break;case"l":this.levelFlight();break}}handleKeyUp(e){switch(e.key.toLowerCase()){case"w":case"s":this.inputs.pitch=0;break;case"a":case"d":this.inputs.roll=0;break;case"c":this.inputs.cameraToggle=!1;break;case" ":this.inputs.shoot=!1;break}}update(e){this.updateFlightPhysics(e),this.updatePlanePosition(e),this.cameraMode==="follow"&&this.updateFollowCamera(e),this.prevInputs.pitch=this.inputs.pitch,this.prevInputs.roll=this.inputs.roll}updateFlightPhysics(e){Math.abs(this.inputs.roll)<.1&&Math.abs(this.inputs.pitch)<.1?this.timeSinceInput+=e:this.timeSinceInput=0,this.controlValues.pitch+=(this.inputs.pitch*v.PITCH_SENSITIVITY-this.controlValues.pitch)*v.INPUT_SMOOTHING*.25,this.controlValues.roll+=(this.inputs.roll*v.ROLL_SENSITIVITY-this.controlValues.roll)*v.INPUT_SMOOTHING;const t=this.controlValues.roll*v.TURN_RATE_FACTOR*e;this.controlValues.yaw=t;const s=this.controlValues.roll*v.YAW_COUPLING*e;if(this.rotation.y+=s,this.timeSinceInput>v.AUTO_LEVEL_DELAY){const n=v.AUTO_LEVEL_RATE;Math.abs(this.inputs.roll)<.1&&(this.controlValues.roll*=1-n)}this.controlValues.pitch=X.clamp(this.controlValues.pitch,-v.MAX_PITCH,v.MAX_PITCH),this.controlValues.roll=X.clamp(this.controlValues.roll,-v.MAX_ROLL,v.MAX_ROLL),this.verticalSpeed=this.controlValues.pitch*v.CLIMB_FACTOR*this.speed,this.rotation.x=this.controlValues.pitch,this.rotation.z=-this.controlValues.roll,this.quaternion.setFromEuler(this.rotation),this.plane.quaternion.copy(this.quaternion),this.heading+=t}updatePlanePosition(e){const o=new S(0,0,1);o.applyQuaternion(this.plane.quaternion);const t=this.speed*(1-Math.abs(this.controlValues.roll)*v.DRAG_FACTOR),s=o.clone().multiplyScalar(t*e),n=this.verticalSpeed*e;this.plane.position.add(s),this.plane.position.y+=n,this.altitude=this.plane.position.y;const r=5;this.plane.position.y<r&&(this.plane.position.y=r,this.verticalSpeed=Math.max(0,this.verticalSpeed))}updateFollowCamera(e){const o=new S(0,0,-1);o.applyQuaternion(this.plane.quaternion);const t=new S(0,1,0);t.applyQuaternion(this.plane.quaternion);const s=this.plane.position.clone();o.multiplyScalar(this.cameraOffset.z),s.add(o),t.multiplyScalar(this.cameraOffset.y),s.add(t),this.camera.position.lerp(s,v.CAMERA_SMOOTHING);const n=new S(0,0,30);n.applyQuaternion(this.plane.quaternion);const r=this.plane.position.clone().add(n);this.camera.lookAt(r)}getForwardDirection(){const e=new S(0,0,1);return e.applyQuaternion(this.plane.quaternion),e.normalize()}getBulletSpawnPosition(){const e=new S(0,0,2.5);return e.applyQuaternion(this.plane.quaternion),this.plane.position.clone().add(e)}getNormalizedSpeed(){return(this.speed-v.MIN_SPEED)/(v.MAX_SPEED-v.MIN_SPEED)}getBankAngleDegrees(){return-X.radToDeg(this.controlValues.roll)}getPitchAngleDegrees(){return X.radToDeg(this.controlValues.pitch)}getHeadingDegrees(){let e=X.radToDeg(this.heading)%360;return e<0&&(e+=360),Math.round(e)}getVerticalSpeed(){return this.verticalSpeed}levelFlight(){this.controlValues.pitch*=.3,this.controlValues.roll*=.3;const e=new CustomEvent("levelFlightActivated");document.dispatchEvent(e)}}class so{constructor(e,o){this.planeControls=e,this.gameState=o,this.container=null,this.speedIndicator=null,this.speedBar=null,this.ufoCounter=null,this.ufoCount=0,this.timeDisplay=null,this.scoreDisplay=null,this.inGameUI=null,this.previousSecond=null,this.createUI(),this.levelFlightIndicatorTimer=0,this.levelFlightIndicatorVisible=!1,document.addEventListener("levelFlightActivated",()=>{this.showLevelFlightIndicator()}),this.gameState&&this.gameState.addEventListener("timeUpdate",t=>{this.timeDisplay&&(this.timeDisplay.textContent=this.formatTime(t.timeRemaining))})}createUI(){this.container=document.createElement("div"),this.container.style.position="absolute",this.container.style.width="100%",this.container.style.height="100%",this.container.style.pointerEvents="none",document.body.appendChild(this.container),this.inGameUI=document.createElement("div"),this.container.appendChild(this.inGameUI),this.createSpeedIndicator(),this.createFlightInstruments(),this.createUFOCounter(),this.gameState&&this.updateUFOCount(this.gameState.totalUFOs),this.createMissionTimer(),this.createScoreDisplay(),this.createControlReference(),this.createVolumeControl(),this.createControlsInfo(),this.createStartScreen(),this.createEndGameScreen(),this.createPauseScreen(),this.createLevelFlightIndicator()}createSpeedIndicator(){const e=document.createElement("div");e.style.position="absolute",e.style.top="20px",e.style.left="20px",e.style.color="white",e.style.fontFamily="Arial, sans-serif",e.style.fontWeight="bold";const o=document.createElement("div");o.textContent="AIRSPEED",o.style.fontSize="14px",o.style.marginBottom="5px",e.appendChild(o);const t=document.createElement("div");t.style.width="150px",t.style.height="12px",t.style.backgroundColor="rgba(0, 0, 0, 0.5)",t.style.borderRadius="6px",t.style.overflow="hidden",e.appendChild(t),this.speedBar=document.createElement("div"),this.speedBar.style.height="100%",this.speedBar.style.backgroundColor="#4CAF50",this.speedBar.style.width="60%",this.speedBar.style.transition="width 0.2s, background-color 0.2s",t.appendChild(this.speedBar),this.speedIndicator=document.createElement("div"),this.speedIndicator.textContent=this.planeControls.speed.toFixed(0),this.speedIndicator.style.fontSize="16px",this.speedIndicator.style.marginTop="5px",e.appendChild(this.speedIndicator),this.container.appendChild(e)}createFlightInstruments(){const e=document.createElement("div");e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.display="flex",e.style.flexDirection="column",e.style.gap="10px",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.padding="15px",e.style.borderRadius="10px",e.style.border="2px solid #555",e.style.zIndex="9998",e.style.color="white",e.style.fontFamily="Arial, sans-serif";const o=document.createElement("div");o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center";const t=document.createElement("div");t.textContent="HEADING",t.style.fontSize="12px",t.style.marginBottom="5px",o.appendChild(t);const s=document.createElement("div");s.style.fontSize="24px",s.style.fontWeight="bold",s.style.fontFamily="'Courier New', monospace",s.textContent="000°",o.appendChild(s);const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.style.marginTop="10px";const r=document.createElement("div");r.textContent="BANK ANGLE",r.style.fontSize="12px",r.style.marginBottom="5px",n.appendChild(r);const l=document.createElement("div");l.style.fontSize="24px",l.style.fontWeight="bold",l.style.fontFamily="'Courier New', monospace",l.textContent="0°",n.appendChild(l);const a=document.createElement("div");a.style.display="flex",a.style.flexDirection="column",a.style.alignItems="center",a.style.marginTop="10px";const c=document.createElement("div");c.textContent="PITCH ANGLE",c.style.fontSize="12px",c.style.marginBottom="5px",a.appendChild(c);const h=document.createElement("div");h.style.fontSize="24px",h.style.fontWeight="bold",h.style.fontFamily="'Courier New', monospace",h.textContent="0°",a.appendChild(h);const u=document.createElement("div");u.style.display="flex",u.style.flexDirection="column",u.style.alignItems="center",u.style.marginTop="10px";const m=document.createElement("div");m.textContent="ALTITUDE",m.style.fontSize="12px",m.style.marginBottom="5px",u.appendChild(m);const w=document.createElement("div");w.style.fontSize="24px",w.style.fontWeight="bold",w.style.fontFamily="'Courier New', monospace",w.textContent="0 M",u.appendChild(w),e.appendChild(o),e.appendChild(n),e.appendChild(a),e.appendChild(u),this.headingValue=s,this.bankValue=l,this.pitchValue=h,this.altValue=w,document.body.appendChild(e)}createUFOCounter(){const e=document.createElement("div");e.style.position="fixed",e.style.top="20px",e.style.left="20px",e.style.color="white",e.style.fontFamily="Arial, sans-serif",e.style.fontWeight="bold",e.style.backgroundColor="rgba(0, 0, 0, 0.8)",e.style.padding="15px",e.style.borderRadius="8px",e.style.width="auto",e.style.minWidth="150px",e.style.zIndex="9999",e.style.border="2px solid #FF5555";const o=document.createElement("div");o.textContent="UFOs REMAINING",o.style.fontSize="16px",o.style.marginBottom="10px",o.style.textAlign="center",e.appendChild(o),this.ufoCounter=document.createElement("div"),this.ufoCounter.textContent="0",this.ufoCounter.style.fontSize="32px",this.ufoCounter.style.textAlign="center",this.ufoCounter.style.color="#FF5555",this.ufoCounter.style.textShadow="0 0 10px rgba(255, 0, 0, 0.7)",this.ufoCounter.style.fontWeight="bold",e.appendChild(this.ufoCounter),document.body.appendChild(e)}createMissionTimer(){const e=document.createElement("div");e.style.position="fixed",e.style.top="20px",e.style.right="20px",e.style.color="white",e.style.fontFamily="Arial, sans-serif",e.style.fontWeight="bold",e.style.backgroundColor="rgba(0, 0, 0, 0.8)",e.style.padding="15px",e.style.borderRadius="8px",e.style.zIndex="9999",e.style.minWidth="150px",e.style.border="2px solid #4CAF50",e.style.transition="border-color 1s, transform 0.3s";const o=document.createElement("div");o.textContent="MISSION TIME",o.style.fontSize="16px",o.style.marginBottom="10px",o.style.textAlign="center",e.appendChild(o),this.timeDisplay=document.createElement("div"),this.timeDisplay.className="mission-timer-value",this.timeDisplay.textContent=this.formatTime(this.gameState?this.gameState.timeRemaining:450),this.timeDisplay.style.fontSize="32px",this.timeDisplay.style.textAlign="center",this.timeDisplay.style.fontFamily="'Courier New', monospace",this.timeDisplay.style.fontWeight="bold",this.timeDisplay.style.textShadow="0 0 5px rgba(255, 255, 255, 0.5)",e.appendChild(this.timeDisplay),this.timerContainer=e,document.body.appendChild(e)}createScoreDisplay(){const e=document.createElement("div");e.style.position="absolute",e.style.top="20px",e.style.right="20px",e.style.color="white",e.style.fontFamily="Arial, sans-serif",e.style.fontWeight="bold",e.style.backgroundColor="rgba(0, 0, 0, 0.5)",e.style.padding="10px",e.style.borderRadius="5px",e.style.textAlign="center";const o=document.createElement("div");o.textContent="SCORE",o.style.fontSize="14px",o.style.marginBottom="5px",e.appendChild(o),this.scoreDisplay=document.createElement("div"),this.scoreDisplay.textContent="0",this.scoreDisplay.style.fontSize="24px",e.appendChild(this.scoreDisplay),this.inGameUI.appendChild(e)}createVolumeControl(){const e=document.createElement("div");e.style.position="absolute",e.style.top="20px",e.style.right="220px",e.style.width="40px",e.style.height="40px",e.style.backgroundColor="rgba(0, 0, 0, 0.5)",e.style.borderRadius="50%",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.cursor="pointer",e.style.pointerEvents="auto",this.volumeIcon=document.createElement("div"),this.volumeIcon.textContent="🔊",this.volumeIcon.style.fontSize="20px",this.volumeIcon.style.color="white",e.appendChild(this.volumeIcon),this.muted=!1,e.addEventListener("click",()=>{this.muted=!this.muted,this.volumeIcon.textContent=this.muted?"🔇":"🔊";const o=new CustomEvent("volumeToggle",{detail:{muted:this.muted}});document.dispatchEvent(o)}),this.container.appendChild(e)}createControlReference(){const e=document.createElement("div");e.style.position="absolute",e.style.bottom="20px",e.style.left="20px",e.style.color="white",e.style.fontFamily="Arial, sans-serif",e.style.backgroundColor="rgba(0, 0, 0, 0.5)",e.style.padding="10px",e.style.borderRadius="5px";const o=document.createElement("div");o.textContent="CONTROLS",o.style.fontWeight="bold",o.style.marginBottom="8px",e.appendChild(o);const t=[{key:"W / S",action:"Pitch up / down (climb/dive)"},{key:"A / D",action:"Roll left / right (bank to turn)"},{key:"Q / E",action:"Decrease / increase speed"},{key:"C",action:"Toggle camera mode"},{key:"SPACE",action:"Fire weapons"}],s=document.createElement("div");s.style.fontSize="11px",s.style.color="#aaffaa",s.style.marginTop="10px",s.style.padding="5px",s.style.borderTop="1px solid #555",s.textContent="✓ Bank angle determines turn rate",e.appendChild(s);const n=document.createElement("div");n.style.fontSize="11px",n.style.color="#aaaaff",n.style.marginTop="5px",n.textContent="✓ Aircraft maintains heading until banked",e.appendChild(n);const r=document.createElement("div");r.style.fontSize="11px",r.style.color="#ffaaaa",r.style.marginTop="5px",r.textContent="✓ Pitch trajectory is maintained until changed",e.appendChild(r),t.forEach(l=>{const a=document.createElement("div");a.style.display="flex",a.style.marginBottom="5px";const c=document.createElement("div");c.textContent=l.key,c.style.fontWeight="bold",c.style.width="70px",a.appendChild(c);const h=document.createElement("div");h.textContent=l.action,a.appendChild(h),e.appendChild(a)}),this.container.appendChild(e)}createControlsInfo(){const e=document.createElement("div");e.className="controls-info",e.style.position="absolute",e.style.bottom="10px",e.style.left="10px",e.style.color="white",e.style.fontFamily="Arial, sans-serif",e.style.fontSize="14px",e.style.backgroundColor="rgba(0, 0, 0, 0.5)",e.style.padding="10px",e.style.borderRadius="5px";const o=[{key:"W / S",action:"Pitch up / down"},{key:"A / D",action:"Roll right / left"},{key:"Q / E",action:"Decrease / Increase speed"},{key:"C",action:"Toggle camera"},{key:"SPACE",action:"Shoot"},{key:"L",action:"Level flight"}],t=document.createElement("div");t.textContent="CONTROLS",t.style.fontWeight="bold",t.style.marginBottom="5px",e.appendChild(t),o.forEach(s=>{const n=document.createElement("div");n.style.marginBottom="3px",n.textContent=`${s.key}: ${s.action}`,e.appendChild(n)}),document.body.appendChild(e)}createStartScreen(){}createEndGameScreen(){}createPauseScreen(){}createLevelFlightIndicator(){this.levelFlightIndicator=document.createElement("div"),this.levelFlightIndicator.className="level-flight-indicator",this.levelFlightIndicator.style.position="absolute",this.levelFlightIndicator.style.top="50%",this.levelFlightIndicator.style.left="50%",this.levelFlightIndicator.style.transform="translate(-50%, -50%)",this.levelFlightIndicator.style.color="white",this.levelFlightIndicator.style.fontFamily="Arial, sans-serif",this.levelFlightIndicator.style.fontSize="20px",this.levelFlightIndicator.style.fontWeight="bold",this.levelFlightIndicator.style.backgroundColor="rgba(0, 128, 0, 0.6)",this.levelFlightIndicator.style.padding="10px 20px",this.levelFlightIndicator.style.borderRadius="5px",this.levelFlightIndicator.style.opacity="0",this.levelFlightIndicator.style.transition="opacity 0.5s ease-in-out",this.levelFlightIndicator.textContent="LEVEL FLIGHT",this.container.appendChild(this.levelFlightIndicator)}showLevelFlightIndicator(){this.levelFlightIndicator.style.opacity="1",this.levelFlightIndicatorVisible=!0,this.levelFlightIndicatorTimer=0}update(){if(this.gameState&&!this.gameState.isPlaying()){this.inGameUI.style.display="none";return}else this.inGameUI.style.display="block";const e=this.planeControls.speed;this.speedIndicator.textContent=e.toFixed(0);const o=this.planeControls.getNormalizedSpeed(),t=(o*100).toFixed(0);if(this.speedBar.style.width=`${t}%`,o<.3?this.speedBar.style.backgroundColor="#F44336":o>.8?this.speedBar.style.backgroundColor="#FF9800":this.speedBar.style.backgroundColor="#4CAF50",this.planeControls){if(this.headingValue){const s=this.planeControls.getHeadingDegrees();this.headingValue.textContent=`${s.toString().padStart(3,"0")}°`,s>=345||s<15?this.headingValue.style.color="#ff4444":s>=75&&s<105?this.headingValue.style.color="#44ff44":s>=165&&s<195?this.headingValue.style.color="#4444ff":s>=255&&s<285?this.headingValue.style.color="#ffff44":this.headingValue.style.color="white"}if(this.bankValue){const s=this.planeControls.getBankAngleDegrees(),n=`${Math.abs(s).toFixed(0)}° ${s<0?"L":s>0?"R":""}`;this.bankValue.textContent=n;const r=Math.abs(s);r>45?this.bankValue.style.color="#ff4444":r>30?this.bankValue.style.color="#ffaa44":r>5?this.bankValue.style.color="#ffff44":this.bankValue.style.color="#44ff44"}if(this.pitchValue){const s=this.planeControls.getPitchAngleDegrees(),n=`${Math.abs(s).toFixed(0)}° ${s<0?"Down":s>0?"Up":""}`;this.pitchValue.textContent=n;const r=Math.abs(s);r>45?this.pitchValue.style.color="#ff4444":r>30?this.pitchValue.style.color="#ffaa44":r>5?this.pitchValue.style.color="#ffff44":this.pitchValue.style.color="#44ff44"}if(this.altValue){const s=Math.round(this.planeControls.altitude);this.altValue.textContent=`${s} M`,s<20?this.altValue.style.color="#ff4444":s<50?this.altValue.style.color="#ffff44":this.altValue.style.color="#44ff44"}}if(this.gameState&&this.timeDisplay&&this.timerContainer){const s=this.gameState.timeRemaining;this.timeDisplay.textContent=this.formatTime(s),this.previousSecond||(this.previousSecond=Math.ceil(s));const n=Math.ceil(s);if(s<=10){const r=Math.floor(Date.now()/250)%2===0;this.timeDisplay.style.color=r?"#ff0000":"white",this.timerContainer.style.border="3px solid #ff0000",this.timerContainer.style.transform=r?"scale(1.05)":"scale(1)",n!==this.previousSecond&&s>0&&(console.log(`Countdown: ${n} seconds remaining`),document.dispatchEvent(new CustomEvent("finalCountdown",{detail:{secondsLeft:n}})))}else if(s<=30){const r=Math.floor(Date.now()/500)%2===0;this.timeDisplay.style.color=r?"#ff6600":"white",this.timerContainer.style.border="2px solid #ff6600",this.timerContainer.style.transform="scale(1)",n!==this.previousSecond&&(n===30||n===20)&&(console.log(`Alarm: ${n} seconds remaining`),document.dispatchEvent(new CustomEvent("finalCountdown",{detail:{secondsLeft:n}})))}else s<=60?(this.timeDisplay.style.color="#ffcc00",this.timerContainer.style.border="2px solid #ffcc00",this.timerContainer.style.transform="scale(1)"):(this.timeDisplay.style.color="white",this.timerContainer.style.border="2px solid #4CAF50",this.timerContainer.style.transform="scale(1)");this.previousSecond=n}this.gameState&&this.scoreDisplay&&(this.scoreDisplay.textContent=this.gameState.score.toString()),this.levelFlightIndicatorVisible&&(this.levelFlightIndicatorTimer+=1/60,this.levelFlightIndicatorTimer>2&&(this.levelFlightIndicator.style.opacity="0",this.levelFlightIndicatorVisible=!1))}updateUFOCount(e){if(this.ufoCount=e,this.ufoCounter){const o=parseInt(this.ufoCounter.textContent);this.ufoCounter.textContent=e.toString(),e<o&&(this.ufoCounter.style.transform="scale(1.5)",this.ufoCounter.style.color="#FF0000",this.ufoCounter.style.transition="transform 0.3s, color 0.3s",setTimeout(()=>{this.ufoCounter.style.transform="scale(1)",this.ufoCounter.style.color="#FF5555"},300))}}formatTime(e){const o=Math.floor(e/60),t=Math.floor(e%60);return`${o.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`}reset(){this.previousSecond=null,this.levelFlightIndicatorVisible=!1,this.levelFlightIndicatorTimer=0,this.levelFlightIndicator&&(this.levelFlightIndicator.style.opacity="0")}}class no{constructor(e){this.scene=e,this.bullets=[],this.bulletSpeed=100,this.bulletLifetime=2,this.cooldown=.2,this.timeSinceLastShot=this.cooldown,this.bulletGeometry=new wt(.2,8,8),this.bulletMaterial=new D({color:16711680,emissive:16711680,emissiveIntensity:.5})}createBullet(e,o){if(this.timeSinceLastShot<this.cooldown)return null;this.timeSinceLastShot=0;const t=new C(this.bulletGeometry,this.bulletMaterial);return t.position.copy(e),t.userData={velocity:o.clone().multiplyScalar(this.bulletSpeed),timeAlive:0},this.scene.add(t),this.bullets.push(t),t}update(e){this.timeSinceLastShot+=e;const o=[];for(let t=0;t<this.bullets.length;t++){const s=this.bullets[t],n=s.userData.velocity.clone().multiplyScalar(e);s.position.add(n),s.userData.timeAlive+=e,s.userData.timeAlive>=this.bulletLifetime&&o.push(t)}for(let t=o.length-1;t>=0;t--){const s=o[t],n=this.bullets[s];this.scene.remove(n),this.bullets.splice(s,1)}}checkCollisions(e){const o=[],t=[],s=new ke(new S,.2);for(let n=0;n<this.bullets.length;n++){const r=this.bullets[n];s.center.copy(r.position);for(const l of e){const a=r.position.distanceToSquared(l.position),c=5*Math.max(l.scale.x,l.scale.z),h=c*c;if(a<=h){o.push(l),t.push(n);break}}}for(let n=t.length-1;n>=0;n--){const r=t[n],l=this.bullets[r];this.scene.remove(l),this.bullets.splice(r,1)}return o}}function io(){const d=new rt,e=new D({color:8947848,specular:3355443,shininess:30}),o=new D({color:7829418,transparent:!0,opacity:.7,specular:16777215,shininess:100}),t=new D({color:65280,emissive:65280,emissiveIntensity:.5}),s=new Lt(5,5,1,32),n=new C(s,e);n.castShadow=!0,d.add(n);const r=new wt(3,32,16,0,Math.PI*2,0,Math.PI/2),l=new C(r,o);l.position.y=.5,l.castShadow=!0,d.add(l);const a=new Qt(5,.5,16,32),c=new C(a,e);c.position.y=-.5,c.rotation.x=Math.PI/2,c.castShadow=!0,d.add(c);const h=new Qt(1,.4,16,32),u=new C(h,e);u.position.y=-.5,u.rotation.x=Math.PI/2,d.add(u);const m=8;for(let x=0;x<m;x++){const g=x/m*Math.PI*2,M=Math.cos(g)*4.5,I=Math.sin(g)*4.5,A=new wt(.3,16,16),L=new C(A,t);L.position.set(M,-.5,I),d.add(L)}const w=new wt(.5,16,16),f=new C(w,t);f.position.y=-.8,d.add(f);const y=new kt(65280,1,20);return y.position.y=-.8,d.add(y),d.userData={hoverSpeed:.2+Math.random()*.3,hoverHeight:.2+Math.random()*.3,rotationSpeed:.2+Math.random()*.5,originalY:0,time:Math.random()*1e3},d}function le(d,e){const o=[];for(let l=0;l<e;l++){const a=io();let c,h,u;const m=Math.random();if(m<.4){const f=Math.random()*120,y=Math.random()*Math.PI*2;c=Math.cos(y)*f,u=Math.sin(y)*f,h=60+20+Math.random()*(150-60-20)}else if(m<.8){const f=120+Math.random()*150,y=Math.random()*Math.PI*2;c=Math.cos(y)*f,u=Math.sin(y)*f,h=60+Math.random()*(150-60-10)}else c=(Math.random()-.5)*400,u=(Math.random()-.5)*400,h=60+Math.random()*(150-60-30);const w=1+Math.random()*.5;a.scale.set(w,w,w),a.position.set(c,h,u),a.userData.originalY=h,a.rotation.y=Math.random()*Math.PI*2,d.add(a),o.push(a)}return o}function ao(d,e){for(const o of d){o.userData.time+=e;const t=Math.sin(o.userData.time*o.userData.hoverSpeed)*o.userData.hoverHeight;o.position.y=o.userData.originalY+t,o.rotation.y+=o.userData.rotationSpeed*e;const s=5,n=.2,r=o.position.x,l=o.position.z;o.position.x=r+Math.sin(o.userData.time*n)*s*.1,o.position.z=l+Math.cos(o.userData.time*n)*s*.1}}const E={START:"start",PLAYING:"playing",PAUSED:"paused",VICTORY:"victory",DEFEAT:"defeat"};class lo{constructor(){this.currentState=E.START,this.score=0,this.maxTime=450,this.timeRemaining=this.maxTime,this.totalUFOs=0,this.destroyedUFOs=0,this.listeners={},this.screens={},this.initScreens()}initScreens(){const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.pointerEvents="none",document.body.appendChild(e),this.screens.start=this.createStartScreen(e),this.screens.victory=this.createVictoryScreen(e),this.screens.defeat=this.createDefeatScreen(e),this.screens.paused=this.createPauseScreen(e),this.updateScreens()}createStartScreen(e){const o=document.createElement("div");o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.backgroundColor="rgba(0, 0, 0, 0.7)",o.style.display="flex",o.style.flexDirection="column",o.style.justifyContent="center",o.style.alignItems="center",o.style.pointerEvents="auto";const t=document.createElement("h1");t.textContent="UFO HUNTER",t.style.fontSize="4rem",t.style.fontFamily="Arial, sans-serif",t.style.color="white",t.style.marginBottom="2rem",t.style.textShadow="0 0 10px #00ff00, 0 0 20px #00ff00",o.appendChild(t);const s=document.createElement("p");s.textContent="Pilot your plane and shoot down the alien invasion!",s.style.fontSize="1.5rem",s.style.fontFamily="Arial, sans-serif",s.style.color="white",s.style.marginBottom="3rem",o.appendChild(s);const n=document.createElement("button");n.textContent="START MISSION",n.style.padding="1rem 2rem",n.style.fontSize="1.5rem",n.style.backgroundColor="#00cc00",n.style.color="white",n.style.border="none",n.style.borderRadius="5px",n.style.cursor="pointer",n.style.transition="all 0.2s",n.style.fontFamily="Arial, sans-serif",n.style.fontWeight="bold",n.style.boxShadow="0 0 10px #00ff00",n.addEventListener("mouseover",()=>{n.style.backgroundColor="#00ff00",n.style.transform="scale(1.05)"}),n.addEventListener("mouseout",()=>{n.style.backgroundColor="#00cc00",n.style.transform="scale(1)"}),n.addEventListener("click",()=>{this.setState(E.PLAYING)}),o.appendChild(n);const r=document.createElement("h2");r.textContent="CONTROLS",r.style.fontSize="1.5rem",r.style.fontFamily="Arial, sans-serif",r.style.color="white",r.style.marginTop="3rem",r.style.marginBottom="1rem",o.appendChild(r);const l=[{key:"W / S",action:"Pitch up / down"},{key:"A / D",action:"Roll right / left"},{key:"Q / E",action:"Decrease / increase speed"},{key:"SPACE",action:"Fire weapons"},{key:"C",action:"Toggle camera mode"},{key:"P",action:"Pause game"}],a=document.createElement("div");return a.style.display="flex",a.style.flexDirection="column",a.style.alignItems="flex-start",a.style.padding="1rem",a.style.backgroundColor="rgba(0, 0, 0, 0.5)",a.style.borderRadius="5px",l.forEach(c=>{const h=document.createElement("div");h.style.display="flex",h.style.marginBottom="0.5rem",h.style.color="white",h.style.fontFamily="Arial, sans-serif";const u=document.createElement("div");u.textContent=c.key,u.style.width="120px",u.style.fontWeight="bold",u.style.color="#00ff00",h.appendChild(u);const m=document.createElement("div");m.textContent=c.action,h.appendChild(m),a.appendChild(h)}),o.appendChild(a),e.appendChild(o),o}createVictoryScreen(e){const o=document.createElement("div");o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.backgroundColor="rgba(0, 0, 0, 0.7)",o.style.display="flex",o.style.flexDirection="column",o.style.justifyContent="center",o.style.alignItems="center",o.style.pointerEvents="auto",o.style.display="none";const t=document.createElement("h1");t.textContent="MISSION ACCOMPLISHED!",t.style.fontSize="4rem",t.style.fontFamily="Arial, sans-serif",t.style.color="#00ff00",t.style.marginBottom="2rem",t.style.textShadow="0 0 10px #00ff00, 0 0 20px #00ff00",o.appendChild(t);const s=document.createElement("div");s.style.fontSize="2rem",s.style.fontFamily="Arial, sans-serif",s.style.color="white",s.style.marginBottom="1rem",o.appendChild(s);const n=document.createElement("div");n.style.fontSize="1.5rem",n.style.fontFamily="Arial, sans-serif",n.style.color="white",n.style.marginBottom="2rem",o.appendChild(n);const r=document.createElement("div");r.style.fontSize="3rem",r.style.fontFamily="Arial, sans-serif",r.style.color="white",r.style.marginBottom="3rem",r.style.fontWeight="bold",o.appendChild(r),this.updateVictoryStats=()=>{const a=this.destroyedUFOs*100,c=Math.round(this.timeRemaining*10),h=a+c;s.textContent=`UFOs Destroyed: ${this.destroyedUFOs} × 100 = ${a} pts`,n.textContent=`Time Bonus: ${this.timeRemaining.toFixed(1)}s × 10 = ${c} pts`,r.textContent=`TOTAL SCORE: ${h} pts`};const l=document.createElement("button");return l.textContent="PLAY AGAIN",l.style.padding="1rem 2rem",l.style.fontSize="1.5rem",l.style.backgroundColor="#00cc00",l.style.color="white",l.style.border="none",l.style.borderRadius="5px",l.style.cursor="pointer",l.style.transition="all 0.2s",l.style.fontFamily="Arial, sans-serif",l.style.fontWeight="bold",l.style.boxShadow="0 0 10px #00ff00",l.style.marginBottom="1rem",l.addEventListener("mouseover",()=>{l.style.backgroundColor="#00ff00",l.style.transform="scale(1.05)"}),l.addEventListener("mouseout",()=>{l.style.backgroundColor="#00cc00",l.style.transform="scale(1)"}),l.addEventListener("click",()=>{this.resetGame(),this.setState(E.PLAYING)}),o.appendChild(l),e.appendChild(o),o}createDefeatScreen(e){const o=document.createElement("div");o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.backgroundColor="rgba(0, 0, 0, 0.85)",o.style.display="flex",o.style.flexDirection="column",o.style.justifyContent="center",o.style.alignItems="center",o.style.pointerEvents="auto",o.style.display="none";const t=document.createElement("h1");t.textContent="MISSION FAILED",t.style.fontSize="4rem",t.style.fontFamily="Arial, sans-serif",t.style.color="#ff3333",t.style.marginBottom="1.5rem",t.style.textShadow="0 0 10px #ff0000, 0 0 20px #ff0000",o.appendChild(t);const s=document.createElement("div");s.style.fontSize="1.5rem",s.style.fontFamily="Arial, sans-serif",s.style.color="#ff9999",s.style.marginBottom="2rem",s.style.textAlign="center",o.appendChild(s);const n=document.createElement("div");n.style.fontSize="2.5rem",n.style.fontFamily="Arial, sans-serif",n.style.color="white",n.style.marginBottom="1rem",n.style.fontWeight="bold",o.appendChild(n);const r=document.createElement("div");r.style.fontSize="2rem",r.style.fontFamily="Arial, sans-serif",r.style.color="white",r.style.marginBottom="3rem",o.appendChild(r),this.updateDefeatStats=()=>{if(this.timeRemaining<=0){s.textContent="TIME EXPIRED";let u=1;const m=setInterval(()=>{u=u===1?.3:1,s.style.opacity=u},500);setTimeout(()=>clearInterval(m),5e3)}else s.textContent="Mission objectives not completed",s.style.opacity=1;n.textContent=`SCORE: ${this.score}`,r.textContent=`UFOs Destroyed: ${this.destroyedUFOs} / ${this.totalUFOs}`};const l=document.createElement("div");l.style.display="flex",l.style.flexDirection="column",l.style.gap="15px",l.style.alignItems="center",o.appendChild(l);const a=document.createElement("button");a.textContent="TRY AGAIN",a.style.padding="1rem 2rem",a.style.fontSize="1.5rem",a.style.backgroundColor="#cc3333",a.style.color="white",a.style.border="none",a.style.borderRadius="5px",a.style.cursor="pointer",a.style.transition="all 0.2s",a.style.fontFamily="Arial, sans-serif",a.style.fontWeight="bold",a.style.boxShadow="0 0 10px #ff0000",a.style.width="250px",a.addEventListener("mouseover",()=>{a.style.backgroundColor="#ff3333",a.style.transform="scale(1.05)"}),a.addEventListener("mouseout",()=>{a.style.backgroundColor="#cc3333",a.style.transform="scale(1)"}),a.addEventListener("click",()=>{this.resetGame(),this.setState(E.PLAYING)}),l.appendChild(a);const c=document.createElement("button");return c.textContent="MAIN MENU",c.style.padding="0.8rem 2rem",c.style.fontSize="1.3rem",c.style.backgroundColor="#555555",c.style.color="white",c.style.border="none",c.style.borderRadius="5px",c.style.cursor="pointer",c.style.transition="all 0.2s",c.style.fontFamily="Arial, sans-serif",c.style.fontWeight="bold",c.style.width="250px",c.addEventListener("mouseover",()=>{c.style.backgroundColor="#777777",c.style.transform="scale(1.05)"}),c.addEventListener("mouseout",()=>{c.style.backgroundColor="#555555",c.style.transform="scale(1)"}),c.addEventListener("click",()=>{this.resetGame(),this.setState(E.START)}),l.appendChild(c),e.appendChild(o),o}createPauseScreen(e){const o=document.createElement("div");o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.backgroundColor="rgba(0, 0, 0, 0.5)",o.style.display="flex",o.style.flexDirection="column",o.style.justifyContent="center",o.style.alignItems="center",o.style.pointerEvents="auto",o.style.display="none";const t=document.createElement("h1");t.textContent="PAUSED",t.style.fontSize="4rem",t.style.fontFamily="Arial, sans-serif",t.style.color="white",t.style.marginBottom="3rem",o.appendChild(t);const s=document.createElement("button");s.textContent="RESUME",s.style.padding="1rem 2rem",s.style.fontSize="1.5rem",s.style.backgroundColor="#00cc00",s.style.color="white",s.style.border="none",s.style.borderRadius="5px",s.style.cursor="pointer",s.style.transition="all 0.2s",s.style.fontFamily="Arial, sans-serif",s.style.fontWeight="bold",s.style.boxShadow="0 0 10px #00ff00",s.style.marginBottom="1rem",s.addEventListener("mouseover",()=>{s.style.backgroundColor="#00ff00",s.style.transform="scale(1.05)"}),s.addEventListener("mouseout",()=>{s.style.backgroundColor="#00cc00",s.style.transform="scale(1)"}),s.addEventListener("click",()=>{this.setState(E.PLAYING)}),o.appendChild(s);const n=document.createElement("button");return n.textContent="RESTART",n.style.padding="1rem 2rem",n.style.fontSize="1.5rem",n.style.backgroundColor="#cccc00",n.style.color="white",n.style.border="none",n.style.borderRadius="5px",n.style.cursor="pointer",n.style.transition="all 0.2s",n.style.fontFamily="Arial, sans-serif",n.style.fontWeight="bold",n.style.boxShadow="0 0 10px #ffff00",n.style.marginBottom="1rem",n.addEventListener("mouseover",()=>{n.style.backgroundColor="#ffff00",n.style.color="black",n.style.transform="scale(1.05)"}),n.addEventListener("mouseout",()=>{n.style.backgroundColor="#cccc00",n.style.color="white",n.style.transform="scale(1)"}),n.addEventListener("click",()=>{this.resetGame(),this.setState(E.PLAYING)}),o.appendChild(n),e.appendChild(o),o}updateScreens(){switch(Object.values(this.screens).forEach(e=>{e.style.display="none"}),this.currentState){case E.START:this.screens.start.style.display="flex";break;case E.VICTORY:this.updateVictoryStats(),this.screens.victory.style.display="flex";break;case E.DEFEAT:this.updateDefeatStats(),this.screens.defeat.style.display="flex";break;case E.PAUSED:this.screens.paused.style.display="flex";break}}setState(e){if(this.currentState===e)return;const o=this.currentState;this.currentState=e,this.updateScreens(),this.notifyListeners("stateChange",{oldState:o,newState:e})}resetGame(){this.score=0,this.timeRemaining=this.maxTime,this.destroyedUFOs=0,this.notifyListeners("gameReset",{})}updateTime(e){this.currentState===E.PLAYING&&(this.timeRemaining-=e,this.timeRemaining<=0&&(this.timeRemaining=0,this.setState(E.DEFEAT)),this.notifyListeners("timeUpdate",{timeRemaining:this.timeRemaining}))}addUFODestroyed(){this.destroyedUFOs++,this.score+=100,this.destroyedUFOs>=this.totalUFOs&&this.setState(E.VICTORY),this.notifyListeners("scoreUpdate",{score:this.score,destroyedUFOs:this.destroyedUFOs})}addScore(e=100){this.score+=e,this.notifyListeners("scoreUpdate",{score:this.score,destroyedUFOs:this.destroyedUFOs})}setTotalUFOs(e){this.totalUFOs=e}isPlaying(){return this.currentState===E.PLAYING}isPaused(){return this.currentState===E.PAUSED}togglePause(){this.currentState===E.PLAYING?this.setState(E.PAUSED):this.currentState===E.PAUSED&&this.setState(E.PLAYING)}addEventListener(e,o){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(o)}removeEventListener(e,o){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(t=>t!==o))}notifyListeners(e,o){this.listeners[e]&&this.listeners[e].forEach(t=>t(o))}}class ro{constructor(e){this.scene=e,this.effects=[],this.particleTexture=new Fe().load("https://threejs.org/examples/textures/sprites/spark1.png")}update(e){const o=[];for(let t=0;t<this.effects.length;t++)this.effects[t].update(e)&&o.push(t);for(let t=o.length-1;t>=0;t--){const s=o[t];this.effects[s].destroy(),this.effects.splice(s,1)}}createExplosion(e,o=5,t=100,s=1.5){const n=new co(this.scene,e,o,t,s,this.particleTexture);return this.effects.push(n),n}createBulletTrail(e,o,t=5,s=.3){const n=new ho(this.scene,e,o,t,s,this.particleTexture);return this.effects.push(n),n}createMuzzleFlash(e,o,t=.1){const s=new uo(this.scene,e,o,t,this.particleTexture);return this.effects.push(s),s}createCameraShake(e,o=1,t=1){const s=new po(this.scene,e,o,t);return this.effects.push(s),s}}class xt{constructor(e,o){this.scene=e,this.duration=o,this.timeAlive=0,this.isComplete=!1}update(e){return this.isComplete?!0:(this.timeAlive+=e,this.timeAlive>=this.duration?(this.isComplete=!0,!0):!1)}destroy(){}}class co extends xt{constructor(e,o,t,s,n,r){super(e,n),this.position=o.clone(),this.radius=t,this.particleCount=s,this.particles=[],this.particleGroup=new rt,this.scene.add(this.particleGroup),this.particleMaterial=new ne({map:r,color:16749824,blending:Ft,transparent:!0,opacity:.8});for(let l=0;l<s;l++){const a=new ie(this.particleMaterial),c=1+Math.random()*2;a.scale.set(c,c,1),a.position.copy(this.position);const h=new S((Math.random()-.5)*2,(Math.random()-.5)*2,(Math.random()-.5)*2);h.normalize().multiplyScalar(t*(.3+Math.random()*.7)),this.particles.push({sprite:a,velocity:h,initialScale:c,rotationSpeed:(Math.random()-.5)*2}),this.particleGroup.add(a)}this.light=new kt(16742144,2,t*3),this.light.position.copy(this.position),this.scene.add(this.light)}update(e){const o=super.update(e),t=this.timeAlive/this.duration;for(let s=0;s<this.particles.length;s++){const n=this.particles[s];if(n.sprite.position.add(n.velocity.clone().multiplyScalar(e)),n.sprite.material.rotation+=n.rotationSpeed*e,t>.3){const l=(t-.3)/.7;n.sprite.material.opacity=1-l}const r=n.initialScale*(1-t*.5);n.sprite.scale.set(r,r,1)}return this.light&&(this.light.intensity=2*(1-t)),o}destroy(){for(let e=0;e<this.particles.length;e++)this.particleGroup.remove(this.particles[e].sprite);this.scene.remove(this.particleGroup),this.light&&this.scene.remove(this.light),this.particles=null,this.particleGroup=null,this.light=null}}class ho extends xt{constructor(e,o,t,s,n,r){super(e,n),this.position=o.clone(),this.direction=t.clone().normalize(),this.length=s;const l=new Oe,a=this.position.clone(),c=this.position.clone().add(this.direction.clone().multiplyScalar(-s)),h=new Float32Array([a.x,a.y,a.z,c.x,c.y,c.z]);l.setAttribute("position",new Re(h,3));const u=new Ne({color:16711680,transparent:!0,opacity:.7,blending:Ft});this.line=new ze(l,u),this.scene.add(this.line)}update(e){const o=super.update(e),t=this.timeAlive/this.duration;return this.line.material.opacity=.7*(1-t),o}destroy(){this.scene.remove(this.line),this.line.geometry.dispose(),this.line.material.dispose(),this.line=null}}class uo extends xt{constructor(e,o,t,s,n){super(e,s),this.position=o.clone(),this.direction=t.clone().normalize(),this.light=new kt(16724736,3,5),this.light.position.copy(this.position),this.scene.add(this.light);const r=new ne({map:n,color:16733440,blending:Ft,transparent:!0,opacity:1});this.sprite=new ie(r),this.sprite.position.copy(this.position),this.sprite.position.add(this.direction.clone().multiplyScalar(.5)),this.sprite.scale.set(2,2,1);const l=new S(0,1,0);new S().crossVectors(this.direction,l).normalize(),this.scene.add(this.sprite)}update(e){const o=super.update(e),t=this.timeAlive/this.duration;let s,n;return t<.2?(s=t/.2,n=1+t*2):(s=1-(t-.2)/.8,n=3-(t-.2)/.8),this.sprite.material.opacity=s,this.sprite.scale.set(n,n,1),this.light.intensity=3*s,o}destroy(){this.scene.remove(this.sprite),this.scene.remove(this.light),this.sprite.material.dispose(),this.sprite=null,this.light=null}}class po extends xt{constructor(e,o,t,s){super(e,s),this.camera=o,this.intensity=t,this.originalPosition=o.position.clone(),this.lastOffset=new S}update(e){const o=super.update(e);if(o)this.camera.position.copy(this.originalPosition);else{const t=1-this.timeAlive/this.duration,s=this.intensity*t*t,n=(Math.random()-.5)*2*s,r=(Math.random()-.5)*2*s,l=(Math.random()-.5)*2*s;this.lastOffset.lerp(new S(n,r,l),.6),this.camera.position.copy(this.originalPosition).add(this.lastOffset)}return o}destroy(){this.camera.position.copy(this.originalPosition)}}class mo{constructor(){this.sounds={},this.music=null,this.volume=.5,this.muted=!1,this.context=null;try{window.AudioContext=window.AudioContext||window.webkitAudioContext,this.context=new AudioContext}catch{console.warn("Web Audio API not supported in this browser")}this.context&&(this.masterGain=this.context.createGain(),this.masterGain.gain.value=this.volume,this.masterGain.connect(this.context.destination)),this.loadSounds()}loadSounds(){[{name:"engine",url:"https://assets.codepen.io/21542/Helicopter2.mp3",loop:!0},{name:"shoot",url:"https://assets.codepen.io/21542/gun-shot.mp3",loop:!1},{name:"explosion",url:"https://assets.codepen.io/21542/Explosion4.mp3",loop:!1},{name:"ufo",url:"https://assets.codepen.io/21542/spaceEngine_000.mp3",loop:!0},{name:"victory",url:"https://assets.codepen.io/21542/success-1.mp3",loop:!1},{name:"defeat",url:"https://assets.codepen.io/21542/negative_beeps.mp3",loop:!1},{name:"button",url:"https://assets.codepen.io/21542/click_003.mp3",loop:!1},{name:"countdown",url:"https://assets.codepen.io/21542/lowDown.mp3",loop:!1},{name:"alarm",url:"https://assets.codepen.io/21542/alarm_loop.mp3",loop:!1},{name:"music",url:"https://assets.codepen.io/21542/Spy+Glass.mp3",loop:!0},{name:"crash",url:"sounds/crash.mp3",loop:!1}].forEach(o=>{this.loadSound(o.name,o.url,o.loop)})}loadSound(e,o,t=!1){this.context&&fetch(o).then(s=>s.arrayBuffer()).then(s=>this.context.decodeAudioData(s)).then(s=>{this.sounds[e]={buffer:s,loop:t,source:null}}).catch(s=>console.error("Error loading sound:",e,s))}play(e,o={}){if(!this.context||this.muted)return null;const t=this.sounds[e];if(!t)return console.warn(`Sound "${e}" not found`),null;o.exclusive&&t.source&&this.stop(e);const s=this.context.createBufferSource();s.buffer=t.buffer,s.loop=t.loop;const n=this.context.createGain();return n.gain.value=o.volume!==void 0?o.volume:1,s.connect(n),n.connect(this.masterGain),t.loop&&(t.source=s,t.gainNode=n),s.start(0),t.loop||(s.onended=()=>{s.disconnect(),n.disconnect()}),{source:s,gainNode:n}}stop(e){if(!this.context)return;const o=this.sounds[e];if(!(!o||!o.source))try{o.source.stop(),o.source.disconnect(),o.gainNode.disconnect(),o.source=null,o.gainNode=null}catch(t){console.warn(`Error stopping sound "${e}":`,t)}}stopAll(){this.context&&Object.keys(this.sounds).forEach(e=>{this.stop(e)})}setVolume(e){this.context&&(this.volume=Math.max(0,Math.min(1,e)),this.masterGain.gain.value=this.volume)}setMute(e){this.context&&(this.muted=e,this.masterGain.gain.value=e?0:this.volume)}toggleMute(){return this.setMute(!this.muted),this.muted}resumeAudioContext(){this.context&&this.context.state==="suspended"&&this.context.resume()}playEngineSound(e,o){if(!this.context||this.muted)return;const t=this.sounds.engine;if(t&&!(!t.source&&!this.play("engine",{volume:.4,exclusive:!0}))&&t.source){const n=.8+e/o*.7;t.source.playbackRate.value=n}}playButtonSound(){this.play("button",{volume:.5})}playShootSound(){this.play("shoot",{volume:.3})}playExplosionSound(){this.play("explosion",{volume:.5})}playVictorySound(){this.stopAll(),this.play("victory",{volume:.7})}playDefeatSound(){this.stopAll(),this.play("defeat",{volume:.7})}startMusic(){this.play("music",{volume:.3,exclusive:!0})}startUFOSound(){this.play("ufo",{volume:.2,exclusive:!0})}playCountdownSound(){this.play("countdown",{volume:.6})}playAlarmSound(){this.play("alarm",{volume:.5})}playCrashSound(){if(!this.sounds.crash){setTimeout(()=>this.playCrashSound(),100);return}const e=this.context.createBufferSource();e.buffer=this.sounds.crash.buffer;const o=this.context.createGain();return o.gain.value=1,e.connect(o),o.connect(this.masterGain),e.start(0),this.stopAll(),e}}class fo{constructor(e,o,t,s){this.scene=e,this.gameState=o,this.effectsManager=t,this.audioManager=s,this.raycaster=new Be,this.planeBox=new It,this.hasCollided=!1,this.GROUND_LEVEL=.5,this.MIN_IMPACT_VELOCITY=10}updatePlaneBoundingBox(e){this.planeBox.setFromObject(e)}checkGroundCollision(e,o){if(this.hasCollided)return!1;if(e.position.y<=this.GROUND_LEVEL){const s=o.getVerticalSpeed(),r=Math.abs(s)>this.MIN_IMPACT_VELOCITY;return{type:"ground",position:new S(e.position.x,0,e.position.z),severity:r?"high":"low",velocity:s}}return!1}checkBuildingCollisions(e,o){if(this.hasCollided)return!1;this.updatePlaneBoundingBox(e);const t=[];o.traverse(s=>{s.userData&&s.userData.type==="building"&&t.push(s)});for(const s of t){const n=new It().setFromObject(s);if(this.planeBox.intersectsBox(n))return{type:"building",position:e.position.clone(),object:s,severity:"high"}}return!1}checkUFOCollisions(e,o){if(this.hasCollided)return!1;this.updatePlaneBoundingBox(e);for(const t of o){const s=new It().setFromObject(t);if(this.planeBox.intersectsBox(s))return{type:"ufo",position:e.position.clone(),object:t,severity:"high"}}return!1}handleCollision(e,o,t){if(this.hasCollided)return;this.hasCollided=!0;const s=e.severity==="high"?8:4,n=e.severity==="high"?150:75,r=e.severity==="high"?2:1.5;return this.effectsManager.createExplosion(e.position,s,n,r),this.audioManager.playCrashSound(),this.createPlaneDebris(o,e),this.gameState.endGame(!1,"Plane Crashed"),this.gameState.isPlaying()&&document.dispatchEvent(new CustomEvent("cameraShake",{detail:{intensity:e.severity==="high"?2:1}})),o.visible=!1,!0}createPlaneDebris(e,o){const t=o.severity==="high"?15:8,s=new rt;this.scene.add(s);const n=[new D({color:16711680}),new D({color:3355443}),new D({color:1118481})];for(let r=0;r<t;r++){const l=Math.random()*.5+.2;let a;const c=Math.floor(Math.random()*3);c===0?a=new $(l,l,l):c===1?a=new Ve(l/2,l,6):a=new Ue(l/2);const h=n[Math.floor(Math.random()*n.length)],u=new C(a,h);u.position.copy(o.position),u.position.x+=(Math.random()-.5)*2,u.position.y+=(Math.random()-.5)*2,u.position.z+=(Math.random()-.5)*2,u.rotation.set(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),u.userData.velocity=new S((Math.random()-.5)*10,Math.random()*5+5,(Math.random()-.5)*10),u.userData.rotationSpeed=new S((Math.random()-.5)*.2,(Math.random()-.5)*.2,(Math.random()-.5)*.2),u.userData.gravity=9.8,u.userData.lifespan=Math.random()*2+3,u.userData.age=0,s.add(u)}this.debris=s}updateDebris(e){if(!this.debris)return;let o=!0;this.debris.children.forEach((t,s)=>{t.userData.age+=e,t.userData.velocity.y-=t.userData.gravity*e,t.position.x+=t.userData.velocity.x*e,t.position.y+=t.userData.velocity.y*e,t.position.z+=t.userData.velocity.z*e,t.rotation.x+=t.userData.rotationSpeed.x,t.rotation.y+=t.userData.rotationSpeed.y,t.rotation.z+=t.userData.rotationSpeed.z,t.position.y<0&&(t.position.y=0,t.userData.velocity.y*=-.3,t.userData.velocity.x*=.8,t.userData.velocity.z*=.8,Math.abs(t.userData.velocity.y)<1&&(t.userData.velocity.y=0)),t.userData.age<t.userData.lifespan?o=!1:(t.material.opacity=Math.max(0,1-(t.userData.age-t.userData.lifespan)),t.material.transparent=!0,t.material.opacity<=.01?this.debris.remove(t):o=!1)}),o&&this.debris.children.length===0&&(this.scene.remove(this.debris),this.debris=null)}reset(){this.hasCollided=!1,this.debris&&(this.scene.remove(this.debris),this.debris=null)}update(e,o,t,s,n){if(this.hasCollided){this.updateDebris(e);return}const r=this.checkGroundCollision(o,t);if(r){this.handleCollision(r,o,t);return}const l=this.checkBuildingCollisions(o,s);if(l){this.handleCollision(l,o,t);return}const a=this.checkUFOCollisions(o,n);if(a){this.handleCollision(a,o,t);return}this.updateDebris(e)}}const F=new Ge,U=new _e(75,window.innerWidth/window.innerHeight,.1,1e3);U.position.set(0,30,60);U.lookAt(0,0,0);const et=new je({antialias:!0});et.setSize(window.innerWidth,window.innerHeight);et.shadowMap.enabled=!0;et.shadowMap.type=Ye;document.body.appendChild(et.domElement);const H=new lo,k=new mo,Q=new Ke(U,et.domElement);Q.enableDamping=!0;Q.dampingFactor=.05;Q.maxPolarAngle=Math.PI/2-.1;Q.minDistance=5;Q.maxDistance=200;Q.enabled=!1;F.fog=new He(8900331,300,1200);const yo=new We(16777215,.7);F.add(yo);const W=new ae(16777215,.9);W.position.set(100,200,100);W.castShadow=!0;W.shadow.mapSize.width=2048;W.shadow.mapSize.height=2048;W.shadow.camera.near=10;W.shadow.camera.far=400;W.shadow.camera.left=-100;W.shadow.camera.right=100;W.shadow.camera.top=100;W.shadow.camera.bottom=-100;F.add(W);const re=new ae(16777164,.4);re.position.set(-50,100,-50);F.add(re);function go(){const d=new rt,e=new Lt(.5,.3,4,8),o=new D({color:16711680}),t=new C(e,o);t.rotation.x=-Math.PI/2,t.castShadow=!0,d.add(t);const s=new $(7,.1,1),n=new D({color:16711680}),r=new C(s,n);r.position.y=0,r.castShadow=!0,d.add(r);const l=new $(2,.1,.7),a=new C(l,n);a.position.z=-1.8,a.castShadow=!0,d.add(a);const c=new $(.1,.8,.7),h=new C(c,n);h.position.z=-1.8,h.castShadow=!0,d.add(h);const u=new rt,m=new Lt(.2,.2,.2,8),w=new D({color:1118481}),f=new C(m,w);f.rotation.x=-Math.PI/2,f.position.z=2.1,u.add(f);const y=new $(.1,1.2,.1),x=new D({color:1118481}),g=new C(y,x);g.position.z=2.1,g.castShadow=!0,u.add(g);const M=new C(y,x);return M.position.z=2.1,M.rotation.z=Math.PI/2,M.castShadow=!0,u.add(M),d.add(u),d.userData.propeller=u,d}const wo=eo();F.add(wo);const ce=Ze(100);F.add(ce);const V=go();V.position.set(0,100,-180);V.rotation.x=X.degToRad(-5);F.add(V);const j=new oo(V,U);U.position.set(0,105,-195);U.lookAt(V.position);const pt=new so(j,H),Tt=new no(F),lt=new ro(F),z=le(F,25);H.setTotalUFOs(z.length);const de=new fo(F,H,lt,k);pt.updateUFOCount(z.length);window.addEventListener("keydown",d=>{d.key.toLowerCase()==="p"&&H.togglePause()});H.addEventListener("stateChange",d=>{const{oldState:e,newState:o}=d;o===E.PLAYING?e===E.START?(k.resumeAudioContext(),k.startMusic(),k.playButtonSound()):e===E.PAUSED&&k.playButtonSound():o===E.PAUSED?k.playButtonSound():o===E.VICTORY?k.playVictorySound():o===E.DEFEAT&&k.playDefeatSound()});H.addEventListener("gameReset",()=>{xo()});document.addEventListener("volumeToggle",d=>{k.setMute(d.detail.muted)});document.addEventListener("finalCountdown",d=>{const e=d.detail.secondsLeft;e<=10&&e>0&&k.playCountdownSound(),(e===30||e===20||e===10)&&k.playAlarmSound()});document.addEventListener("cameraShake",d=>{const e=d.detail.intensity||1,o=d.detail.duration||1;lt.createCameraShake(U,e,o)});function xo(){for(;z.length>0;){const e=z.pop();F.remove(e)}const d=le(F,25);z.push(...d),H.setTotalUFOs(z.length),pt.updateUFOCount(z.length),pt.reset(),V.position.set(0,100,-180),V.rotation.x=X.degToRad(-5),V.visible=!0,U.position.set(0,105,-195),U.lookAt(V.position),de.reset(),k.stopAll(),k.startMusic()}let oe=performance.now();function he(){requestAnimationFrame(he);const d=performance.now(),e=(d-oe)/1e3;oe=d;const o=Math.min(e,.1);if(H.updateTime(o),H.isPlaying()){if(V.userData.propeller){const s=.5+j.speed/20;V.userData.propeller.rotation.z+=s}if(j.cameraMode==="follow"?(Q.enabled=!1,j.update(o)):(Q.enabled=!0,Q.update(),j.updateFlightPhysics(o),j.updatePlanePosition(o)),j.inputs.shoot){const s=j.getBulletSpawnPosition(),n=j.getForwardDirection();Tt.createBullet(s,n)&&(k.playShootSound(),lt.createMuzzleFlash(s,n),lt.createBulletTrail(s,n))}Tt.update(o);const t=Tt.checkCollisions(z);for(const s of t){lt.createExplosion(s.position.clone(),5,100,1.5),k.playExplosionSound(),F.remove(s);const n=z.indexOf(s);n!==-1&&z.splice(n,1),H.addUFODestroyed(),pt.updateUFOCount(z.length),H.addScore(100)}ao(z,o),lt.update(o),k.playEngineSound(j.speed,v.MAX_SPEED),de.update(o,V,j,ce,z)}pt.update(),bo(),et.render(F,U)}window.addEventListener("resize",()=>{U.aspect=window.innerWidth/window.innerHeight,U.updateProjectionMatrix(),et.setSize(window.innerWidth,window.innerHeight)});const K=document.createElement("div");K.style.position="absolute";K.style.top="10px";K.style.right="10px";K.style.color="white";K.style.backgroundColor="rgba(0,0,0,0.5)";K.style.padding="10px";K.style.borderRadius="5px";K.style.fontFamily="monospace";K.id="stats";document.body.appendChild(K);let Dt=0,se=performance.now();function bo(){Dt++;const d=performance.now(),e=d-se;if(e>=1e3){const o=Math.round(Dt*1e3/e);document.getElementById("stats").textContent=`FPS: ${o}`,Dt=0,se=d}}he();
